---
description: Detect fresh/unconfigured repo and push users to run setup
globs: ["**/*"]
---

# Fresh Repo Detection & Onboarding

## Priority: Run This First

Before responding to ANY user request, check if this is a fresh or unconfigured repository.

## Detection Checks

Run these checks silently (don't output the commands to the user):

### 1. Check for `.env` file
```bash
test -f .env && echo "EXISTS" || echo "MISSING"
```

### 2. Check for `node_modules/`
```bash
test -d node_modules && echo "EXISTS" || echo "MISSING"
```

### 3. Check for Prisma client
```bash
test -d node_modules/.prisma && echo "EXISTS" || echo "MISSING"
```

### 4. Check git email is @rippling.com
```bash
git config user.email
```

## Fresh Repo Indicators

The repo needs setup if ANY of these are true:
- `.env` file is MISSING
- `node_modules/` directory is MISSING
- `node_modules/.prisma/` directory is MISSING
- Git email is not `@rippling.com`

## Response When Fresh Repo Detected

If ANY indicator is true, respond with this BEFORE addressing the user's request:

```
⚠️ **Setup Required**

This repository hasn't been fully configured yet. Before we proceed, let's get you set up:

[Show which items need attention:]
- ❌ No `.env` file (environment not configured)
- ❌ No `node_modules/` (dependencies not installed)
- ❌ No Prisma client (database not configured)
- ❌ Git email not @rippling.com

**Run `/setup` now** to:
1. Configure your environment variables
2. Install dependencies
3. Generate Prisma client
4. Create your user in the database
5. Test Snowflake connection

This only takes a minute and ensures queries and reports work properly.

Would you like me to run `/setup` for you now?
```

## When to Skip This Check

Skip the fresh repo check if:
- User explicitly says "skip setup" or "I'll set up later"
- User is asking about the setup process itself (e.g., "/help setup")
- User is running `/setup` command
- All checks pass (repo is properly configured)

## After Setup is Complete

Once setup passes, don't show this message again in the conversation. Proceed normally with user requests.

## Why This Matters

- Missing `.env` means queries won't work (no database or Snowflake credentials)
- Missing `node_modules` means scripts and dev server won't run
- Missing Prisma client means database operations fail
- Non-Rippling email means user can't be created in the database
- Users who skip setup hit confusing permission and connection errors later
